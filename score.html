<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Exam Result Analysis</title>
    <script>
        window.MathJax = { tex: { inlineMath: [['$', '$']] } };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: sans-serif; background: #f4f7f9; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .sol-card { border-left: 5px solid #ccc; padding: 15px; margin: 20px 0; background: #fff; border: 1px solid #eee; border-left-width: 6px; }
        .correct { border-left-color: #5cb85c; background: #f9fff9; }
        .incorrect { border-left-color: #d9534f; background: #fff9f9; }
        .svg-container svg { max-width: 300px; height: auto; border: 1px solid #ddd; margin: 10px 0; background: white; }
        .sol-meta { font-size: 0.9em; color: #666; margin-top: 10px; border-top: 1px dashed #ccc; padding-top: 10px; }
    </style>
</head>
<body>
<div class="container">
    <h1>Detailed Solutions</h1>
    <div id="solutions"></div>
</div>

<script>
    const data = JSON.parse(localStorage.getItem("exam_result"));
    const solDiv = document.getElementById('solutions');

    Object.keys(data.sections).forEach(sec => {
        data.sections[sec].forEach((q, i) => {
            const isMcq = q.options !== undefined;
            const isCorrect = isMcq ? (String(q.answer) === String(q.correct)) : (parseFloat(q.answer) === parseFloat(q.correct_val || q.answer)); 
            
            const card = document.createElement('div');
            card.className = `sol-card ${q.answer === null ? '' : (isCorrect ? 'correct' : 'incorrect')}`;
            
            let html = `<strong>${sec} - Q${i+1}</strong><p>${q.q}</p>`;
            if(q.svg) html += `<div class="svg-container">${q.svg}</div>`;
            
            const userDisp = isMcq ? (q.answer !== null ? q.options[q.answer] : 'Not Answered') : (q.answer || 'Not Answered');
            const corrDisp = isMcq ? q.options[q.correct] : (q.correct_val || q.answer);

            html += `<div><strong>Your Answer:</strong> ${userDisp}</div>`;
            html += `<div><strong>Correct Answer:</strong> <span style="color:green">${corrDisp}</span></div>`;
            html += `<div class="sol-meta"><strong>Solution:</strong> ${q.solution || 'No explanation provided.'}</div>`;
            
            card.innerHTML = html;
            solDiv.appendChild(card);
        });
    });

    // Final trigger for MathJax after DOM is built
    window.onload = () => {
        if(window.MathJax) MathJax.typeset();
    };
</script>
</body>
</html>
